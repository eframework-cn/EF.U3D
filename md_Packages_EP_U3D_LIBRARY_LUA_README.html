<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EFramework: EP.U3D.LIBRARY.LUA</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="ef-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">EFramework
   </div>
   <div id="projectbrief">A LITE U3D-BASED FRAMEWORK.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_Packages_EP_U3D_LIBRARY_LUA_README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">EP.U3D.LIBRARY.LUA </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>ToLua module that refers from <a href="https://github.com/topameng/tolua">https://github.com/topameng/tolua</a>. <br  />
 <a href="https://u3d.eframework.cn/namespaceEP_1_1U3D_1_1LIBRARY_1_1LUA.html">Go to Scripting API</a></p>
<h1><a class="anchor" id="autotoc_md236"></a>
SUMMARY | 功能概述</h1>
<p>tolua# is a Unity lua static binder solution. the first solution that analyzes code by reflection and generates wrapper classes.<br  />
 It is a Unity plugin that greatly simplifies the integration of C# code with Lua. which can automatically generate the binding code to access Unity from Lua and map c# constants, variables, functions, properties, classes, and enums to Lua.<br  />
 tolua# grows up from cstolua. it's goal is to be a powerful development environment for Unity.<br  />
 Support unity4.6.x and Unity5.x all(copy /Unity5.x/Assets to /Assets) <br  />
 If you want to test examples(example 1 is excluded)in mobile, first click menu Lua/Copy lua files to Resources. then build it <br  />
 如果你想在手机上测试例子(例子1除外)，首先点击菜单Lua/Copy lua files to Resources， 之后再build. <br  />
</p>
<p>欢迎大家点星支持，谢谢^_^<br  />
 有bug 可以到QQ群286510803反馈。 可以加讨论群: <br  />
 ulua&amp;tolua技术交流群① 341746602(已满) <br  />
 ulua&amp;tolua技术讨论群② 469941220(已满) <br  />
 tolua::技术讨论群④ 543826216(已满)<br  />
 tolua::技术群 286510803<br  />
</p>
<h2><a class="anchor" id="autotoc_md237"></a>
Library</h2>
<p><b>tolua_runtime</b> <br  />
 <a href="https://github.com/topameng/tolua_runtime">https://github.com/topameng/tolua_runtime</a> <br  />
 <b>Debugger</b> <br  />
 <a href="https://github.com/topameng/Debugger">https://github.com/topameng/Debugger</a> <br  />
 <b>CString</b> <br  />
 <a href="https://github.com/topameng/CString">https://github.com/topameng/CString</a> <br  />
 <b>protoc-gen-lua</b> <br  />
 <a href="https://github.com/topameng/protoc-gen-lua">https://github.com/topameng/protoc-gen-lua</a> <br  />
</p>
<h2><a class="anchor" id="autotoc_md238"></a>
FrameWork and Demo</h2>
<p><b>LuaFrameWork</b><br  />
 <a href="https://github.com/jarjin/LuaFramework_NGUI">https://github.com/jarjin/LuaFramework_NGUI</a> <br  />
 <a href="https://github.com/jarjin/LuaFramework_UGUI">https://github.com/jarjin/LuaFramework_UGUI</a> <br  />
 <b>XlsxToLua</b><br  />
 <a href="https://github.com/zhangqi-ulua/XlsxToLua">https://github.com/zhangqi-ulua/XlsxToLua</a><br  />
 <b>UnityHello</b><br  />
 <a href="https://github.com/woshihuo12/UnityHello">https://github.com/woshihuo12/UnityHello</a><br  />
 <b>UWA-ToLua</b><br  />
 <a href="http://uwa-download.oss-cn-beijing.aliyuncs.com/plugins%2FiOS%2FUWA-iOS-ToLua.zip">http://uwa-download.oss-cn-beijing.aliyuncs.com/plugins%2FiOS%2FUWA-iOS-ToLua.zip</a><br  />
</p>
<h2><a class="anchor" id="autotoc_md239"></a>
Debugger</h2>
<p><b>EmmyLua</b><br  />
 <a href="https://github.com/tangzx/IntelliJ-EmmyLua">https://github.com/tangzx/IntelliJ-EmmyLua</a><br  />
 <b>unity_tolua-_zerobrane_api</b><br  />
 <a href="https://github.com/LabOfHoward/unity_tolua-_zerobrane_api">https://github.com/LabOfHoward/unity_tolua-_zerobrane_api</a><br  />
</p>
<h2><a class="anchor" id="autotoc_md240"></a>
Packages</h2>
<p>　**Basics**　　　　　　　　**Math**　　　　　　**Data Structures**<br  />
 　luabitop　　　　　　　Quaternion　　　　　　　list<br  />
 　 struct　　　　　　　 　Vector3　　　　　　　　event<br  />
 　 int64　　　　 　　　 　Vector4　　　　　　　　slot<br  />
 　 Time　　　　 　　　 　Vector2<br  />
 **Networking**　　　　 　　　Ray<br  />
 　luasocket　　　　 　　　 Color<br  />
 　**Parsing**　　　　 　　　Bounds<br  />
 　lpeg　　 　　 　　　 　 　Mathf<br  />
 　**Protol**　　　　　 　 　　 Touch<br  />
 　pblua　　　 　　 　 　RaycastHit<br  />
 </p>
<h2><a class="anchor" id="autotoc_md241"></a>
特性</h2>
<ul>
<li>自动生成绑定代码文件，非反射调用 <br  />
</li>
<li>大量内建基础类型支持，如枚举，委托，事件，Type, 数组，迭代器等 <br  />
</li>
<li>支持多种协同形式 <br  />
</li>
<li>支持所有unity内部类导出，支持委托类型导出 <br  />
</li>
<li>支持导出自定义，跳过某个空的基类，修改导出名称等 <br  />
</li>
<li>支持扩展函数自定义导出, 比如DoTween <br  />
</li>
<li>支持值类型Nullable导出，包括Nullable&lt;Vector3&gt;等 <br  />
</li>
<li>支持Lua中function转委托，可以区分需要不同委托的参数的重载函数 <br  />
</li>
<li>支持c# LuaFunction对象转委托，简化调用方式。 支持无GC的多参数调用形式 <br  />
</li>
<li>支持重载函数自动折叠, 如:Convert.ToUInt32只导出double参数的函数 <br  />
</li>
<li>支持重载函数自动排序, 如:参数个数相同, object参数执行级最低, 不会出现错误匹配情况 <br  />
</li>
<li>支持导出函数重命名, 可以分离导出某个重载函数(可以导出被折叠掉的函数) <br  />
</li>
<li>支持使用编辑器类改写导出规则 <br  />
</li>
<li>支持this数组访问，索引为int可以通过[]访问，其他可使用.get_Item或者.this:get()访问数组成员 <br  />
</li>
<li>支持委托(事件)+-lua function。支持通过函数接口的Add和Remove委托操作 <br  />
</li>
<li>支持静态反射操作, 形式同c# <br  />
</li>
<li>支持peer表，可在lua端扩展导出的userdata <br  />
</li>
<li>支持自定义struct压入和读取，做到无GC，并且结构成员无类型限制, 参考例子24 <br  />
</li>
<li>支持preloading, 可以通过requie后绑定wrap文件 <br  />
</li>
<li>支持int64, uint64 <br  />
</li>
<li>大量的lua数学类型，如Quaternion, Vector3, Mathf等</li>
<li>包含第三方lua扩展，包括luasocket, struct, lpeg, utf8, pb等库 <br  />
</li>
<li>当lua出现异常，能够同时捕获c::端和lua端堆栈，便于调试 <br  />
</li>
<li>print信息，在编辑器点击日志, 能自动打开对应lua文件 <br  />
</li>
<li>支持unity所有版本 <br  />
</li>
<li>**支持Lua hook C::相代码实现，一定程度上支持利用Lua代码修改C::端代码的bug**（<a href="https://zhuanlan.zhihu.com/p/35124260">暖更新使用说明</a>） <br  />
</li>
</ul>
<h2><a class="anchor" id="autotoc_md242"></a>
快速入门</h2>
<p>在CustomSetting.cs中添加需要导出的类或者委托，类加入到customTypeList列表，委托加入到customDelegateList列表 <br  />
 通过设置saveDir变量更改导出目录,默认生成在Assets/Source/Generate/下,点击菜单Lua-&gt;Generate All,生成绑定文件 <br  />
 在LuaConst.cs中配置开发lua文件目录luaDir以及tolua lua文件目录toluaDir <br  />
 </p><div class="fragment"><div class="line"><span class="comment">//例子1</span></div>
<div class="line">LuaState lua = <span class="keyword">new</span> LuaState();</div>
<div class="line">lua.Start();</div>
<div class="line">lua.DoString(<span class="stringliteral">&quot;print(&#39;hello world&#39;)&quot;</span>);</div>
<div class="line">lua.Dispose();</div>
<div class="line"> </div>
<div class="line"><span class="comment">//例子2</span></div>
<div class="line">LuaState luaState = <span class="keyword">null</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Awake()</div>
<div class="line">{</div>
<div class="line">    luaState = LuaClient.GetMainState();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {            </div>
<div class="line">        luaState.Call(<span class="stringliteral">&quot;UIShop.Awake&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> (Exception e)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//Awake中必须这样特殊处理异常</span></div>
<div class="line">        luaState.ThrowLuaException(e);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Start()</div>
<div class="line">{</div>
<div class="line">    luaState.Call(<span class="stringliteral">&quot;UIShop.Start&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line">local go = GameObject(&#39;go&#39;)</div>
<div class="line">go:AddComponent(typeof(UnityEngine.ParticleSystem))</div>
<div class="line">go.transform.position = Vector3.zero</div>
<div class="line">go.transform:Rotate(Vector3(0,90,0), UnityEngine.Space.World)</div>
<div class="line">go.transform:Rotate(Vector3(0, 1, 0), 0)</div>
<div class="line"> </div>
<div class="line">--DoTween 需要在CustomSetting导出前定义USING_DOTWEENING宏，或者取消相关注释</div>
<div class="line">go.transform:DORotate(Vector3(0,0,360), 2, DG.Tweening.RotateMode.FastBeyond360)</div>
<div class="line"> </div>
<div class="line">Shop = {}</div>
<div class="line"> </div>
<div class="line">function Shop:Awake()</div>
<div class="line">    self.OnUpdate = UpdateBeat:CreateListener(Shop.Update, self)</div>
<div class="line">    UpdateBeat:AddListener(self.OnUpdate)</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function Shop:OnDestroy()</div>
<div class="line">    UpdateBeat:RemoveListener(self.OnUpdate)</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function Shop:OnClick()</div>
<div class="line">    print(&quot;OnClick&quot;)</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function Shop:OnToggle()</div>
<div class="line">    print(&quot;OnToggle&quot;)</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function Shop:Update()</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">--委托</div>
<div class="line">local listener = UIEventListener.Get(go)</div>
<div class="line">listener.onClick = function() print(&quot;OnClick&quot;) end</div>
<div class="line">listener.onClick = nil</div>
<div class="line">listener.onClick = UIEventListener.VoidDelegate(Shop.OnClick, Shop)</div>
<div class="line">listener.onClick = listener.onClick + UIEventListener.VoidDelegate(Shop.OnClick, Shop)</div>
<div class="line">listener.onClick = listener.onClick - UIEventListener.VoidDelegate(Shop.OnClick, Shop)</div>
<div class="line"> </div>
<div class="line">local toggle = go:GetComponent(typeof(UIToggle))</div>
<div class="line">EventDelegate.Add(toggle.onChange, EventDelegate.Callback(Shop.OnToggle, Shop))</div>
<div class="line">EventDelegate.Remove(toggle.onChange, EventDelegate.Callback(Shop.OnToggle, Shop))</div>
<div class="line"> </div>
<div class="line">--事件</div>
<div class="line">local Client = {}</div>
<div class="line"> </div>
<div class="line">function Client:Log(str)</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">Application.logMessageReceived = Application.logMessageReceived + Application.LogCallback(Clent.Log, Client)</div>
<div class="line">Application.logMessageReceived = Application.logMessageReceived - Application.LogCallback(Clent.Log, Client)</div>
<div class="line"> </div>
<div class="line">--out参数</div>
<div class="line">local _layer = 2 ^ LayerMask.NameToLayer(&#39;Default&#39;)</div>
<div class="line">local flag, hit = UnityEngine.Physics.Raycast(ray, nil, 5000, _layer)</div>
<div class="line"> </div>
<div class="line">if flag then</div>
<div class="line">    print(&#39;pick from lua, point: &#39;..tostring(hit.point))</div>
<div class="line">end</div>
</div><!-- fragment --><p> 这里是更多的示例。 </p>
<h2><a class="anchor" id="autotoc_md243"></a>
关于反射</h2>
<p>tolua# 不支持动态反射。动态反射对于重载函数有参数匹配问题，函数排序问题，ref,out 参数问题等等。<br  />
 tolua::提供的替换方法是:<br  />
</p><ol type="1">
<li>preloading, 把你未来可能需要的类型添加到导出列表customTypeList，同时也添加到dynamicList列表中，这样导出后该类型并不会随binder注册到lua中，你可以通过 require "namespace.classname" 动态注册到lua中，对于非枚举类型tolua::系统也可以在第一次push该类型时动态载入，当然也可在过场动画、资源下载、登录、场景加载或者某个的函数中require这个类型。<br  />
</li>
<li>静态反射，参考例子22。通过静态反射支持精确的函数参数匹配和类型检查。不会存在重载函数参数混乱匹配错误问题, 注意iOS必须配置好link.xml<br  />
</li>
</ol>
<h2><a class="anchor" id="autotoc_md244"></a>
Performance</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">平台   </th><th class="markdownTableHeadCenter">属性读写   </th><th class="markdownTableHeadCenter">重载函数   </th><th class="markdownTableHeadCenter">Vector3构造   </th><th class="markdownTableHeadCenter">GameObject构造   </th><th class="markdownTableHeadCenter">Vector3归一化   </th><th class="markdownTableHeadCenter">Slerp    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">PC   </td><td class="markdownTableBodyCenter">0.0465:0.15   </td><td class="markdownTableBodyCenter">0.076:0.12   </td><td class="markdownTableBodyCenter">0.02:0.001   </td><td class="markdownTableBodyCenter">0.1:0.14   </td><td class="markdownTableBodyCenter">0.014:0.001   </td><td class="markdownTableBodyCenter">0.10:0.11    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Android   </td><td class="markdownTableBodyCenter">0.16:1.1   </td><td class="markdownTableBodyCenter">0.28:0.76   </td><td class="markdownTableBodyCenter">0.17:0.00035   </td><td class="markdownTableBodyCenter">0.43:0.5   </td><td class="markdownTableBodyCenter">0.21:0.02   </td><td class="markdownTableBodyCenter">0.3:0.06    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">iOS   </td><td class="markdownTableBodyCenter">0.04:0.145   </td><td class="markdownTableBodyCenter">0.055:0.11   </td><td class="markdownTableBodyCenter">0.017:0.05   </td><td class="markdownTableBodyCenter">0.074:0.08   </td><td class="markdownTableBodyCenter">0.035:0.11   </td><td class="markdownTableBodyCenter">0.078:0.5   </td></tr>
</table>
<p>测试结果为C#:Lua. 环境不同会略有差异。可用数字倍率做参考<br  />
 PC: Intel(R) Core(TM) i5-4590 <a href="#" onclick="location.href='mai'+'lto:'+'CPU'+'@3'+'.3G'+'Hz'; return false;">CPU@3<span class="obfuscator">.nosp@m.</span>.3GH<span class="obfuscator">.nosp@m.</span>z</a> + 8GB + 64 位win7 + Unity5.4.5p4<br  />
 Android: 中兴nubia z9 max(NX512J) + Adnroid5.0.2<br  />
 iOS(il2cpp): IPhone6 Plus<br  />
 按照1.0.7.355版本更新了测试数据, u5相对u4, 安卓上c::有了不小的提升<br  />
 </p>
<h2><a class="anchor" id="autotoc_md245"></a>
Examples</h2>
<p>参考包内1-24例子</p>
<h2><a class="anchor" id="autotoc_md246"></a>
About Lua</h2>
<p>win, android ios using luajit2.1-beta3. macos using luac5.1.5(for u5.x). 注意iOS未编译模拟器库，请用真机测试</p>
<h1><a class="anchor" id="autotoc_md247"></a>
MANUAL | 使用手册</h1>
<h1><a class="anchor" id="autotoc_md248"></a>
FAQ | 常见问题</h1>
<h1><a class="anchor" id="autotoc_md249"></a>
TODO | 待办事项</h1>
<h1><a class="anchor" id="autotoc_md250"></a>
REFER | 引用说明</h1>
<h1><a class="anchor" id="autotoc_md251"></a>
LICENSE | 许可声明</h1>
<h1><a class="anchor" id="autotoc_md252"></a>
CHANGELOG | 更新日志</h1>
<ul>
<li><b>SEE <a href="https://u3d.eframework.cn/index.html#autotoc_md8">CHANGELOG.md</a> FOR MORE DETAILS.</b> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Nov 9 2023 15:08:12 for EFramework by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
